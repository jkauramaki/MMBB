<!DOCTYPE html>
<html>
  <head>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="./langFetch.js"></script>
    <script src="https://unpkg.com/jspsych@7.1.2"></script>
    <script src="../../jspsych/dist/plugin-html-songselector-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-slider-response.js"></script>
    <script src="../../jspsych/dist/plugin-audio-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-instructions.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-likert.js"> </script>
    <script src="../../jspsych/dist/plugin-canvas-button-response.js"> </script>
    <script src="../../jspsych/dist/extension-accelerometer.js"> </script>
    <script src="../../jspsych/dist/plugin-html-keyboard-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-multi-choice.js"> </script>
    <script src="../../jspsych/dist/plugin-initialize-microphone.js"> </script>
    <script src="../../jspsych/dist/plugin-audio-keyboard-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-audio-response.js"> </script>
    <script src="../../jspsych/dist/plugin-preload.js"> </script>
    <script src="../../songs/movementTapAudio/songKeysNames.js"> </script>
    <script src="../../jspsych/dist/custom/utils.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-html-form.js"> </script>
    <script src="../../jspsych/dist/custom/beatProductionFunctions.js"></script>
    <script src="../../songs/movementTapAudio/songKeysNames.js"></script>


    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css">
    <link rel="stylesheet" href="./generalCSS.css">

    <script src="./translations.js"></script>
    <script src="./generalIntro.js"></script>

    <!--Fetching timelines for each task-->
    <script src="./movement.js"> </script>
    <script src="./bat.js"> </script>
    <script src="./tapping.js"> </script>

  </head>

  <body></body>

  <script>

    window.onbeforeunload = function() {
        return "If you leave now, data may not be saved";
    }

    var jsPsych = initJsPsych({
      extensions: [
        {type: jsPsychExtensionAccelerometer }
      ],
      on_finish: function() {
        //jsPsych.data.displayData();

        var finalData = jsPsych.data.get()
        var measurePerformance = performance.getEntriesByType('resource');
        finalData['performance'] = measurePerformance
        finalData.localSave('json', 'mydata.json')
      }
    });

    //var sequenceTasks = [movementTimeline, tappingTimeline, batTimeline]
    var sequenceTasks = [movementTimeline, batTimeline, tappingTimeline]
    var sequenceTasks = jsPsych.randomization.shuffle(sequenceTasks);
    
    var completeSequence = [generalIntroWrap, sequenceTasks[0], sequenceTasks[1], sequenceTasks[2], messageEndTask]
    var completeSequence = completeSequence.flat()

    jsPsych.run(completeSequence);

 </script>
</html>
