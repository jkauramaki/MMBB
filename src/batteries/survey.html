<!DOCTYPE html>
<html>
  <head>
    <title>MMBB batery</title>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../jspsych/dist/graphFunction.js"> </script>
    <script src="https://unpkg.com/jspsych@7.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.0"></script>
    <script src="../../jspsych/dist/plugin-audio-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-slider-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-html-form.js"> </script>
    <script src="../../jspsych/dist/plugin-image-slider-response.js"> </script>
    <script src="../../jspsych/dist/plugin-instructions.js"> </script>
    <script src="../../jspsych/dist/plugin-free-sort.js"> </script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.2"></script>
    <script src="../../jspsych/dist/plugin-canvas-button-response.js"> </script>
    <script src="../../jspsych/dist/extension-accelerometer.js"> </script>
    <script src="../../jspsych/dist/plugin-html-keyboard-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-multi-choice.js"> </script>
    <script src="../../jspsych/dist/plugin-initialize-microphone.js"> </script>
    <script src="../../jspsych/dist/plugin-html-audio-response.js"> </script>
    <script src="./questionnaires.js"> </script>

    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

  </head>
  <body></body>
  <script>

    var jsPsych = initJsPsych({
      extensions: [
        {type: jsPsychExtensionAccelerometer }
      ],
      on_finish: function() {
        //jsPsych.data.displayData();
        jsPsych.data.get().localSave('csv','mydata.csv');
      }
    });
    
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    var diadNumber = urlParams.get('diad')
    if(diadNumber == null){
      alert('You did not put the diad number as URL parameter. Automatically assigning diad number 1. To change, add "?diad=2" to the end of the URL')
      var diadNumber = 1
    }
    console.log(diadNumber)
  
    var participantID = {
      type: jsPsychSurveyHtmlForm,
      preamble: '<p style="font-size:7vw">Participant ID</p>',
      html: '<p><input type="text" id="test-resp-box" name="response" size="10" /></p>',
      autofocus: 'test-resp-box'
    };

    var instruction1 = {
        type: jsPsychInstructions,
        pages: [
        'When you click start, you will see some questions.',
        'Your task is to answer them.'
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }

    const sorting_stimuli = ['./img/survey/a.001.png', './img/survey/a.002.png']

    var howFeeling = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
                    <p style="font-size:3vw;">How do you feel?
                   </div>`,
        require_movement: true,
        labels: ['Extremely bad', 'Very bad', 'Bad', 'Good', 'Very good', 'Extremely good'],
        data: { previousHowFeeling: 'true' }
    };

    var howFeeling2 = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
                    <p style="font-size:3vw;">How do you feel?
                   </div>`,
        require_movement: true,
        labels: ['Extremely bad', 'very bad', 'bad', 'good', 'very good', 'extremely good'],
        data: { previousHowFeeling: 'true' },
        on_start: function(trial) {
          var howFeelingPrevious = jsPsych.data.get().filter({previousHowFeeling: 'true'})['trials']
          var howFeelingPrevious = howFeelingPrevious.slice(-1)[0]
          var howFeelingPrevious = howFeelingPrevious['response']
          trial.slider_start = howFeelingPrevious
        }
    };

    var relationshipFriend = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
                    Please rate your relationship with the first person you danced and created a playlist with
                   </div>`,
        require_movement: true,
        labels: ['We are best friends', 'We are very good friends', 'We know each other but rarely interact', "We don't know each other at all"],
    };

    var relationshipFriend2 = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
                      Please rate your relationship with the second person you danced and created a playlist with
                   </div>`,
        require_movement: true,
        labels: ['We are best friends', 'We are very good friends', 'We know each other but rarely interact', "We don't know each other at all"],
    };


    var howWasPlaylist = {
        type: jsPsychHtmlSliderResponse,
        stimulus: `<div style="width:500px;">
                    How easy was to reach a decision regarding the playlist?
                   </div>`,
        require_movement: true,
        labels: ['Very hard', 'Very easy']
    };

    var trialSurvey = {
      type: jsPsychSurveyMultiChoice,
      questions: [{
          prompt: 'Implement questionnaire here',
          options: ['Option 1', 'Option 2', 'Option 3'], 
          required: false
        }]
    };
 
    var options = [
      "Strongly Disagree", 
      "Disagree", 
      "Neutral", 
      "Agree", 
      "Strongly Agree"
    ];

    var instructionPreCloseness = {
      type: jsPsychInstructions,
      pages: [
      'In the next page, use the slider to indicate how close you feel to your pair',
      ],
      button_label_next: "Next",
      button_label_previous: "Previous",
      show_clickable_nav: true
    }

    var closeness1 = {
      type: jsPsychImageSliderResponse,
      stimulus: ['../emotion_demo/basic_emoji/v5a1.png', '../emotion_demo/basic_emoji/v5a1.png'],
      stimulus_width: 200,
      min: 0,
      slider_start: 0,
      step: 1,
      max: 490,
      maintain_aspect_ration: true,
    };

    var closeness2 = {
      type: jsPsychImageSliderResponse,
      stimulus: ['../emotion_demo/basic_emoji/v5a1.png', '../emotion_demo/basic_emoji/v5a1.png'],
      stimulus_width: 200,
      min: 0,
      slider_start: 500,
      step: 1,
      max: 490,
      maintain_aspect_ration: true,
      on_start: function(trial) {
        var closenessTrials = jsPsych.data.get().filter({stimulus: "../emotion_demo/basic_emoji/v5a1.png"})
        var closenessTrials = closenessTrials['trials']
        var startPoint = closenessTrials[closenessTrials.length - 1]['response']
        console.log(startPoint)
        trial.slider_start = startPoint
        trial.start_separation = startPoint
      }
    };

    var inter = {
        type: jsPsychInstructions,
        pages: [
        'Please, hand the ipad back to the experimenter',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }

    var shortBreak = {
        type: jsPsychInstructions,
        pages: [
        'Now we are having a short break. Please, hand the ipad to the experimenter.',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }

    var likeSong = {
        type: jsPsychHtmlSliderResponse,
        stimulus: "How much do you like the song that you just heard?",
        require_movement: true,
        labels: ['Not at all', 'Very much']
    };

    var familiaritySong = {
        type: jsPsychHtmlSliderResponse,
        stimulus: "How familiar were you with the song that you just heard?",
        require_movement: true,
        labels: ['Never heard it before', 'Know it very well']
    };

 //- Please rate your relationship with the first person you danced and created a playlist with
 //- Please rate your relationship with the second person you danced and created a playlist with   

    //Determining which timeline to run
    if(diadNumber == "a"){ //Pair A
      var timelineChosen = [participantID,
                            howFeeling,  instructionPreCloseness, closeness1, inter,
                            howWasPlaylist, howFeeling2, instructionPreCloseness, closeness2, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, modelQuestionnaire1, modelQuestionnaire2, modelQuestionnaire3, howFeeling2, instructionPreCloseness, closeness2, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong,
                            shortBreak]
    }
    if(diadNumber == "b"){ //Pair B
      var timelineChosen = [participantID, 
                            howFeeling,  instructionPreCloseness, closeness1, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, inter,
                            howFeeling2, instructionPreCloseness, closeness2, inter, howWasPlaylist,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, modelQuestionnaire1, modelQuestionnaire2, modelQuestionnaire3, howFeeling2, instructionPreCloseness, closeness2,
                            howFeeling2, instructionPreCloseness, closeness2,
                            shortBreak]
    }
    if(diadNumber == "c"){ //Pair c
      var timelineChosen = [participantID,
                            howFeeling,  instructionPreCloseness, closeness1, inter,
                            howWasPlaylist, howFeeling2, instructionPreCloseness, closeness2, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, modelQuestionnaire1, modelQuestionnaire2, modelQuestionnaire3, howFeeling2, instructionPreCloseness, closeness2, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, inter,
                            relationshipFriend, relationshipFriend2]
    }
    if(diadNumber == "d"){ //Pair d
      var timelineChosen = [participantID, 
                            howFeeling,  instructionPreCloseness, closeness1, inter,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, inter,
                            howFeeling2, instructionPreCloseness, closeness2, inter, howWasPlaylist,
                            howFeeling2, instructionPreCloseness, closeness2, likeSong, familiaritySong, modelQuestionnaire1, modelQuestionnaire2, modelQuestionnaire3, howFeeling2, instructionPreCloseness, closeness2,
                            howFeeling2, instructionPreCloseness, closeness2, inter,
                            relationshipFriend, relationshipFriend2]
    }

    jsPsych.run(timelineChosen);
    //jsPsych.run([instruction1, closeness, trialLikert, trialSurvey]);

 </script>
</html>
