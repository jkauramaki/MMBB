<!DOCTYPE html>
<html>
  <head>
    <title>MMBB batery</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/jspsych@7.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.0"></script>
    <script src="../../jspsych/dist/plugin-audio-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-text.js"> </script>
    <script src="../../jspsych/dist/plugin-html-slider-response.js"> </script>
    <script src="../../jspsych/dist/plugin-html-button-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-html-form.js"> </script>
    <script src="../../jspsych/dist/plugin-image-slider-response.js"> </script>
    <script src="../../jspsych/dist/plugin-instructions.js"> </script>
    <script src="../../jspsych/dist/plugin-free-sort.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-likert.js"> </script>
    <script src="../../jspsych/dist/plugin-canvas-button-response.js"> </script>
    <script src="../../jspsych/dist/extension-accelerometer.js"> </script>
    <script src="../../jspsych/dist/plugin-html-keyboard-response.js"> </script>
    <script src="../../jspsych/dist/plugin-survey-multi-choice.js"> </script>
    <script src="../../jspsych/dist/plugin-initialize-microphone.js"> </script>
    <script src="../../jspsych/dist/plugin-html-audio-response.js"> </script>
    <link href="../../jspsych/dist/jspsych.css" rel="stylesheet" type="text/css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

  </head>
  <body></body>
  <script>

    var jsPsych = initJsPsych({
      extensions: [
        {type: jsPsychExtensionAccelerometer }
      ],
      on_finish: function() {
        //jsPsych.data.displayData();
        jsPsych.data.get().localSave('csv','mydata.csv');
      }
    });

    var instruction1 = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:5vw;">Welcome!</p>',
        '<p style="font-size:5vw;">We are interested in your musical taste</p>',
        '<p style="font-size:5vw;">Tell us 3 songs that you like to dance to</p>',
        '<p style="font-size:5vw;">If possible, give us only youtube links</p>',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }

    var song1 = {
      type: jsPsychSurveyText,
      preamble: 'Song 1 <div style="text-shadow: 0px 0px 0px #000000;"><a href="https://www.youtube.com" target="_blank">Open YouTube in new tab</a></div>',
      questions: [
        {prompt: '1. Name and artist', required: false},
        {prompt: '1. Youtube link*', required: true},
        {prompt: '1. Spotify link', required: false},
      ],
      on_load: function(){
        document.getElementById("jspsych-survey-text-next").style.marginTop = '50px'
        document.querySelector(".jspsych-display-element").style.lineHeight = "25px"
      }
    }

    var song2 = {
      type: jsPsychSurveyText,
      preamble: 'Song 2 <div style="text-shadow: 0px 0px 0px #000000;"><a href="https://www.youtube.com" target="_blank">Open YouTube in new tab</a></div>',
      questions: [
        {prompt: '2. Name and artist', required: false},
        {prompt: '2. Youtube link*', required: true},
        {prompt: '2. Song spotify link', required: false},
      ],
      on_load: function(){
        document.getElementById("jspsych-survey-text-next").style.marginTop = '50px'
        document.querySelector(".jspsych-display-element").style.lineHeight = "25px"
      }
    }

    var song3 = {
      type: jsPsychSurveyText,
      preamble: 'Song 3 <div style="text-shadow: 0px 0px 0px #000000;"><a href="https://www.youtube.com" target="_blank">Open YouTube in new tab</a></div>',
      questions: [
        {prompt: '3. Name and artist', required: false},
        {prompt: '3. Youtube link*', required: true},
        {prompt: '3. Spotify link', required: false},
      ],
      on_load: function(){
        document.getElementById("jspsych-survey-text-next").style.marginTop = '50px'
        document.querySelector(".jspsych-display-element").style.lineHeight = "25px"
      }
    }


    var instruction2 = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:5vw;">Now tell us a bit about yourself</p>',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }

    var age = {
        type: jsPsychHtmlSliderResponse,
        stimulus: '<div style="font-size:35px">How old are you?</div><div id="showAge" style="font-size:20px">50</div>',
        require_movement: true,
        labels: ['<div style="font-size:20px">0</div>', '<div style="font-size:20px">100+</div>'],
        on_load: function(){
          document.getElementById("jspsych-html-slider-response-next").style.height = "100px"
          document.getElementById("showAge").style.marginTop = "10px"
        }
    };

    var country = {
      type: jsPsychSurveyText,
      preamble: '<div style="font-size:35px">About your nationality</div>',
      questions: [
        {prompt: 'In which country were you borne?', required: true},
        {prompt: 'Where do you live?', required: true},
      ],
      on_load: function(){
        document.getElementById("input-1").style.marginBottom = "60px"
        document.querySelector(".jspsych-survey-text").style.fontSize = "20px"
      }
    }
 
    var instruction4 = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:5vw;">Ok,</p>',
        '<p style="font-size:5vw;">This is the end of the survey</p>',
        '<p style="font-size:5vw;">Press "Next" to send us your responses</p>',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true,
    }

  
    var instruction6 = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:5vw;">Last task before you leave</p>',
        '<p style="font-size:5vw;">We want to measure if there\'s a delay in the audio</p>',
        '<p style="font-size:5vw;">You will hear a series of clicks</p>',
        '<p style="font-size:5vw;">Press the button as soon as you hear each one of them</p>',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }
    //Audio timing 2000, 3500, 4500, 6000, 7800, 9500
    var tappingAudio = {
        type: jsPsychAudioButtonResponse,
        choices: ['Tap here'],
        stimulus: './songs/beatLags.wav',
        response_ends_trial: false,
        trial_duration: 13000,
    }

    function change(time, color) {
          setTimeout(() => {document.body.style.backgroundColor = color}, time);
    }

    var instruction7 = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:5vw;">Finally,</p>',
        '<p style="font-size:5vw;">Press the button every time you see a color change</p>',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true
    }
    //Audio timing 2000, 3500, 4500, 6000, 7800, 9500
    var tappingColor = {
        type: jsPsychAudioButtonResponse,
        choices: ['Tap here'],
        stimulus: './songs/movementTapAudio/silence.wav',
        response_ends_trial: false,
        trial_duration: 13000,
        on_start: function(trial) {
            var times = [2000, 3500, 4500, 6000, 7800, 9500]
            var colors = ["red", "blue", "green", "purple", "yellow", "brown"]
            for(k in times){
              change(times[k], colors[k])
            }
            change(13000, "#808080")
        },
    }

    var instruction8 = {
        type: jsPsychInstructions,
        pages: [
        '<p style="font-size:5vw;">Press next to download the data</p>',
        ],
        button_label_next: "Next",
        button_label_previous: "Previous",
        show_clickable_nav: true,
        on_finish: function(){
          alert("You can now close this page")
        }
    }

    jsPsych.run([instruction1, song1, song2, song3, instruction2, age, country, instruction4]);

 </script>
</html>
